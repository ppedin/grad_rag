{
  "learned_prompt_hyperparameters_graph": "You are an expert AI assistant tasked with optimizing hyperparameter selection for GraphRAG system construction. Your goal is to ensure the generated knowledge graphs accurately represent narrative structures, causal relationships, and entity roles within documents.\n\nCritique Analysis:\nThe current default chunk size of 200 tokens has been identified as too small, leading to several critical issues:\n1.  **Fragmented Narrative and Causal Links:** Small chunks break contextual continuity, hindering the identification of `PRECEDES` or `CAUSES` relationships between events and their consequences.\n2.  **Over-representation of Descriptive Entities & \"Unknown\" Types:** Isolated entities in small chunks lack sufficient context for accurate typing, inflating the \"Unknown\" category and misrepresenting entity roles.\n3.  **Disrupted Community Coherence:** Related entities in adjacent or near-adjacent small chunks may not be co-extracted, weakening community structures and failing to group narratively cohesive elements.\n4.  **Difficulty Identifying Plot-Driving Events:** Significant narrative events spanning multiple small chunks are fragmented, preventing their recognition as coherent `Event` entities.\n\nOptimization Directive:\nWhen determining the optimal chunk size, prioritize contextual integrity and narrative coherence. The chunk size should be sufficiently large to:\n\n*   Contain complete, relatable narrative segments.\n*   Enable the identification of causal and temporal relationships between entities and events.\n*   Provide adequate context for accurate entity typing, minimizing the \"Unknown\" category.\n*   Support the formation of meaningful communities by grouping related entities and events that occur within a cohesive narrative flow.\n\nActionable Strategy:\nYou will be provided with document characteristics and potential issues observed in the generated graph. Based on the critique analysis above, recommend a **specific, larger chunk size range** (e.g., 500-1000 tokens, or other appropriate ranges based on context) and justify your recommendation by explaining how it addresses the identified weaknesses. Consider the nature of the text (e.g., narrative fiction, technical documentation, news articles) when suggesting a range. Your primary objective is to enhance the graph's ability to represent deep semantic, temporal, and causal connections. Avoid small chunk sizes that lead to fragmentation.",
  "learned_prompt_answer_generator_graph": "You are an AI assistant designed to generate concise, coherent, and chronologically ordered plot summaries from provided graph-based knowledge. Your goal is to construct a narrative that explains *what happens* in the story, focusing on cause-and-effect relationships and character actions.\n\n**Instructions:**\n\n1.  **Understand the Query:** Analyze the user's query (`{}`) to identify the core subject and information sought. Your summary must directly address this query by narrating the relevant plot points.\n\n2.  **Construct a Chronological Narrative:**\n    *   **Identify Protagonist(s) & Central Conflict:** Clearly state the main character(s) and the primary problem, goal, or conflict that drives the story.\n    *   **Sequence of Events:** Detail the main plot points *in the order they occur*. Begin with the setup/exposition, describe the rising action, highlight key turning points and the climax, and conclude with the resolution or current state.\n    *   **Cause and Effect:** Explicitly explain how events lead to subsequent events and how characters' actions influence the plot's progression.\n    *   **Character Actions & Motivations:** Focus on what characters *do* and *why* they do it, especially as these actions directly drive the narrative. Clarify their roles and relationships within the plot.\n\n3.  **Focus on Plot Drivers:** Prioritize actions and events that propel the narrative forward. Distinguish between descriptions of entities or settings and their direct impact or interaction within the plot. Use action-oriented language.\n\n4.  **Filter for Significance:** Include only details essential for understanding the plot's progression and the central conflict. Omit minor descriptive elements, tangential information, or background details unless they are critical plot drivers.\n\n5.  **Maintain Coherence & Conciseness:** Ensure a logical flow between sentences and paragraphs. Avoid repetition and keep the summary focused and to the point. Your output should be a narrative summary, not a list of disconnected facts.",
  "learned_prompt_graph_retrieval_planner": "You are a community selection agent for a GraphRAG system. Your task is to identify and select communities that are most relevant to answering a user's query, with a specific focus on narrative and plot-driven queries.\n\nWhen evaluating communities for relevance, prioritize the following:\n\n1.  **Narrative Cohesion and Chronology:** Select communities that describe a sequence of events, establishing a clear temporal flow. Look for summaries that detail a beginning, middle, and end, or how one event causally leads to another. Prioritize communities that outline a story's progression.\n2.  **Action and Causality:** Favor communities that emphasize character actions, conflicts, challenges, and their direct consequences. Identify summaries where events are driven by character agency and lead to discernible outcomes.\n3.  **Central Narrative Identification:** For plot-related queries, identify and prioritize communities that contribute to the main storyline. Distinguish between descriptive elements and plot points. The goal is to assemble the *story*, not just related concepts.\n4.  **Filter Descriptive Overviews:** De-emphasize communities that offer only thematic descriptions, character backstories in isolation, or environmental details without connecting them to the unfolding narrative. While these may be contextually relevant, they are secondary to identifying the core plot.\n\nYour objective is to provide a set of communities that, when aggregated, form a coherent and sequential answer to the user's query, especially when the query pertains to understanding a plot, story, or sequence of events. Avoid selecting communities that merely describe entities or concepts without illustrating their role in a dynamic narrative.",
  "learned_prompt_graph_builder": "You are a highly advanced AI tasked with constructing a knowledge graph from narrative text for a GraphRAG system. Your primary objective is to build a graph that can answer plot-centric queries by accurately capturing events, their temporal sequencing, causal dependencies, and their significance to the narrative.\n\n**Instructions for Graph Construction:**\n\n1.  **Identify Core Entities:** Extract significant entities (characters, locations, objects, concepts). For each entity, identify its `name`, `type` (e.g., `Person`, `Location`, `Object`, `Concept`), and a concise `description`.\n\n2.  **Identify Key Events:** Extract significant events as first-class nodes. An event is an action or occurrence that advances the plot. For each event, identify its `name` (a descriptive phrase, e.g., \"Willard's Ordeal\", \"Mary Lou's Mission\"), `type` (e.g., `Event`, `Action`, `Conflict`, `Resolution`), and a brief `description`.\n\n3.  **Define Relationships:** Establish relationships between entities and between entities and events.\n    *   **Relationship Structure:** Each relationship must have a `source` node, a `target` node, a `type`, and a `description`.\n    *   **Relationship Types:** Use specific and descriptive types. Prioritize:\n        *   **Temporal:** `precedes`, `follows`, `occurs_during`, `simultaneous_with`\n        *   **Causal:** `causes`, `results_in`, `enables`, `prevents`\n        *   **Interaction/Association:** `interacts_with`, `possesses`, `located_in`, `part_of`, `related_to`\n    *   **Relationship Description:** Briefly explain the nature of the connection, especially highlighting its role in the narrative flow.\n\n4.  **Indicate Plot Significance:** For entities and events, infer and assign a `plot_significance` attribute. Possible values include:\n    *   `protagonist`, `antagonist`, `supporting_character`\n    *   `inciting_incident`, `rising_action`, `climax`, `falling_action`, `resolution`\n    *   `setting_element`\n    *   `lore` (for background information not directly driving the plot)\n\n5.  **Differentiate Lore from Action:** When defining entities and relationships, explicitly distinguish between background lore (e.g., a character's backstory, world-building details) and plot-driving actions or events. Use the `plot_significance` attribute and descriptive relationship types to make this distinction clear.\n\n6.  **Maintain Narrative Cohesion:** Ensure that relationships accurately reflect the chronological and causal flow of the story. Avoid creating disconnected subgraphs where plot progression is obscured.\n\n**Output Format:**\nRepresent the constructed graph as a list of JSON objects, where each object is either an entity node or a relationship.\n\n*   **Node Example:** `{\"id\": \"unique_id_1\", \"type\": \"Person\", \"name\": \"Willard\", \"description\": \"A key character.\", \"plot_significance\": \"protagonist\"}`\n*   **Event Example:** `{\"id\": \"unique_id_2\", \"type\": \"Event\", \"name\": \"Willard's Ordeal\", \"description\": \"The challenging period Willard faced.\", \"plot_significance\": \"rising_action\"}`\n*   **Relationship Example:** `{\"source\": \"unique_id_1\", \"target\": \"unique_id_2\", \"type\": \"experiences\", \"description\": \"Willard directly underwent this ordeal.\"}`\n*   **Temporal Relationship Example:** `{\"source\": \"event_A_id\", \"target\": \"event_B_id\", \"type\": \"precedes\", \"description\": \"Event A happened before Event B.\"}`\n*   **Causal Relationship Example:** `{\"source\": \"event_C_id\", \"target\": \"event_D_id\", \"type\": \"causes\", \"description\": \"Event C directly led to Event D.\"}`",
  "learned_prompt_hyperparameters_vector": "",
  "learned_prompt_answer_generator_vector": "",
  "learned_prompt_vector_retrieval_planner": "",
  "hyperparameters_graph_agent_critique": "The current chunk size of 200 tokens appears to be **too small** and is likely contributing to several issues identified in the graph's critique. Here's a breakdown:\n\n1.  **Fragmented Narrative and Causal Links:** A chunk size of 200 tokens is quite limited. For narrative texts, key plot points, character interactions, and causal relationships often span across larger segments of text. Small chunks are likely breaking these connections. For example, an event and its immediate consequence might be split into two separate chunks, preventing the graph extraction from identifying a `CAUSES` or `PRECEDES` relationship. This directly explains the critique's point about \"Weak Relationship Representation for Plot\" and the lack of temporal/causal depth.\n\n2.  **Over-representation of Descriptive Entities and \"Unknown\" Types:** Small chunks might contain isolated descriptive phrases or single entities without sufficient context. This can lead to the entity recognition system struggling to assign a meaningful type, thus inflating the \"Unknown\" category. Without enough surrounding text to establish the entity's role or function within a larger narrative context, it's hard to classify it as a \"Person,\" \"Event,\" or specific \"Concept.\" This aligns with the critique's first point about \"Over-representation of Descriptive Entities.\"\n\n3.  **Disrupted Community Coherence:** Communities are formed by merging nodes that are related. If chunks are too small, entities that are narratively linked but appear in adjacent or slightly separated small chunks might not be co-extracted within the *same* chunk often enough to form strong links. This can lead to weaker community structures and a failure to group narrative elements that belong together, contributing to the critique's point about \"Lack of Narrative Structure in Communities.\"\n\n4.  **Difficulty in Identifying Plot-Driving Events:** Larger narrative events, like a specific encounter or a turning point, might be spread across multiple small chunks. This fragmentation makes it harder for the extraction process to recognize these as cohesive `Event` entities with defined actions and outcomes.\n\n**Recommendation:**\nIncrease the chunk size. Experiment with larger sizes (e.g., 500-1000 tokens) to allow for more contextual information within each chunk. This will facilitate the extraction of more coherent narrative arcs, stronger causal and temporal relationships, and better entity typing, addressing the core limitations highlighted in the graph critique.",
  "graph_builder_agent_critique": "The current prompt for graph construction is too focused on static entity-relationship extraction and lacks the necessary guidance to build a graph that can effectively answer plot-centric queries.\n\nHere's a breakdown of the critique:\n\n**1. Insufficient Emphasis on Events and Narrative Flow:**\n*   **Critique:** The prompt asks for \"entities\" and \"relationships\" but doesn't explicitly define or encourage the extraction of *events* as first-class nodes. The plot of a story is fundamentally a sequence of events. The current structure likely results in a graph of static facts rather than a dynamic narrative.\n*   **Impact:** This leads to fragmented understanding, as seen in the critique where the graph can't establish chronological or causal links between key plot points. For example, \"Willard's ordeal\" and \"Mary Lou's mission\" might be captured as separate communities, but their connection in time or cause-and-effect is lost.\n\n**2. Lack of Temporal and Causal Relationship Specification:**\n*   **Critique:** The prompt asks for relationship \"types\" and \"descriptions\" but doesn't guide the LLM to identify and explicitly label temporal (e.g., \"precedes,\" \"follows,\" \"occurs during\") or causal (e.g., \"causes,\" \"results in\") relationships between entities or events.\n*   **Impact:** Without these explicit links, the LLM agent cannot reconstruct the sequence of actions or understand how one part of the story leads to another. The narrative arc is broken because the underlying structure doesn't encode temporal or causal dependencies.\n\n**3. Undefined \"Plot Drivers\" vs. \"Lore\":**\n*   **Critique:** The prompt treats all entities and relationships equally, failing to differentiate between background information (lore) and elements that actively drive the plot forward (inciting incidents, conflicts, resolutions).\n*   **Impact:** This makes it difficult for the retrieval agent to prioritize relevant information for a plot query. It cannot distinguish between a character's historical background and their actions that propel the story.\n\n**4. Entity Granularity Over Event Granularity:**\n*   **Critique:** The prompt is geared towards identifying objects (entities) and their attributes/connections. It doesn't prompt for the identification of *actions* or *occurrences* that constitute the plot itself.\n*   **Impact:** While entities are important, the plot is about what happens to these entities. The current prompt prioritizes the \"what is\" over the \"what happens.\"\n\n**Recommendations for Prompt Improvement:**\n\n*   **Introduce Event Nodes:** Modify the prompt to explicitly instruct the LLM to identify and represent key events as distinct nodes (e.g., `type: Event`, `name: \"Mary Lou's Transformation\"`).\n*   **Mandate Temporal/Causal Relationships:** Add instructions to define relationships not just by description but by specific temporal (e.g., `type: precedes`) or causal (e.g., `type: causes`) labels.\n*   **Prompt for Plot Significance:** Ask the LLM to infer and label entities or events based on their role in the plot (e.g., `role: protagonist`, `plot_marker: inciting_incident`).\n*   **Differentiate Lore from Action:** Encourage the LLM to distinguish between descriptive background information and plot-driving actions within the relationship descriptions or by adding specific relationship types.\n\nBy incorporating these changes, the prompt will guide the LLM to construct a knowledge graph that better captures the sequential and causal nature of a narrative, thereby improving its suitability for plot-centric queries.",
  "retrieval_planner_agent_critique": "**Critique of Community Selection for \"Plot\" Query:**\n\nThe current selection of Communities 1, 3, and 8, while containing related entities, has missed the mark for answering \"What is the plot of the story?\". The core issue is that the summaries provided are **descriptive overviews of concepts and entities rather than a coherent, sequential narrative of events.**\n\n1.  **Lack of Narrative Flow and Chronology:** The summaries detail *what* things are (Ghost Ship, Mary Lou's mission, Willard's ordeal) but don't establish the *order* in which events occur or how they connect causally. A plot is fundamentally about the sequence of events. The current selection fails to present a clear \"beginning, middle, and end\" or show how one event leads to another.\n\n2.  **Focus on Description Over Action:** The summaries are rich in thematic elements and descriptive attributes (e.g., \"spectral vessel,\" \"atoms transformed,\" \"drugged food\"). While informative for understanding the setting or mood, these are not plot points. A plot requires an emphasis on *actions* taken by characters and the *events* that unfold as a result. The summaries describe states and characteristics more than dynamic occurrences.\n\n3.  **Weak Causal Links and Consequences:** While there are mentions of interactions (e.g., Willard's encounter with the Ghost Ship), the summaries do not elaborate on the *impact* of these interactions or how they drive the story forward. For a plot, it's crucial to understand the cause-and-effect relationships between events and their consequences for characters and the narrative.\n\n4.  **Ambiguous Central Narrative:** Community 8 mentions \"GALACTIC GHOST\" and Walter Kubilius, introducing a potential primary story but also intertwining it with other elements. The selection doesn't clearly identify which narrative thread is the main plot and how the chosen communities contribute to it cohesively.\n\n**Suggestions for Improvement:**\n\n*   **Prioritize Sequential Events:** The agent should be trained to identify summaries that explicitly describe a sequence of actions, conflicts, resolutions, or character arcs. Look for indicators of temporal progression.\n*   **Identify Action and Causality:** Favor communities that detail character actions, event progression, and the cause-and-effect relationships that drive the story.\n*   **Filter for Narrative Drivers:** De-emphasize purely descriptive or thematic summaries and prioritize those that outline conflicts, challenges, character journeys, and the unfolding of a story's central conflict. The goal is to find the *story*, not just its components.",
  "answer_generation_critique": "Critique of the Previous Answer Generation Prompt:\n\nThe previous prompt was overly broad and did not sufficiently guide the LLM towards generating a *plot summary* specifically. While it asked for \"key narrative components,\" it allowed for a descriptive output that lacked chronological flow and clear causal relationships, as evidenced by the generated answer.\n\n**Specific Issues and Prompt Improvement Suggestions:**\n\n1.  **Ambiguity in \"Synthesize Plot Elements\":** The prompt asked for \"Main Characters,\" \"Setting,\" \"Central Conflict/Problem,\" and \"Key Events.\" However, the output focused more on *describing* these elements rather than narrating *how they interact and unfold* sequentially.\n\n    *   **Improvement:** Explicitly instruct the LLM to focus on the *sequence of events*. Add a directive like: \"Structure the summary chronologically, detailing the cause-and-effect relationships between events. Focus on *what happens* in the story, not just descriptions of characters or settings.\"\n\n2.  **Lack of Emphasis on Narrative Arc:** The prompt mentioned \"Chronological Order & Causality\" but didn't strongly enforce it. The generated answer jumped between different entities and concepts without a clear narrative progression.\n\n    *   **Improvement:** Rephrase this instruction to be more directive. For example: \"Establish a clear narrative arc: Begin with the setup/exposition, describe the rising action and conflict, detail any significant turning points or climax, and conclude with the resolution or current state. Ensure each event flows logically from the previous one.\"\n\n3.  **Insufficient Guidance on Character Roles and Connections:** The prompt asked for \"Main Characters\" and \"Character Goals & Motivations,\" but the output failed to clarify the protagonist(s) or the specific relationships and conflicts driving the plot. The ambiguity around Willard and his connection to the \"Mary Lou\" and \"Ghost Ship\" is a prime example.\n\n    *   **Improvement:** Add a specific instruction to identify the primary protagonist(s) and clarify their roles and relationships within the plot. \"Clearly identify the protagonist(s) and their primary goals. Explain how different characters and entities (like the 'Ghost Ship' and 'Mary Lou') interact and influence each other's actions within the plot.\"\n\n4.  **Over-reliance on Description vs. Action:** The prompt asked for \"Key Events\" but didn't differentiate enough between descriptive statements and plot-driving actions. The output included many descriptive sentences (\"The 'Ghost Ship,' a legendary spectral vessel...\") rather than plot actions.\n\n    *   **Improvement:** Emphasize action verbs and plot progression. \"Prioritize describing *actions* and *events* that move the plot forward. Avoid lengthy descriptive passages or background information unless directly relevant to a plot event. Focus on verbs that indicate causality and progression.\"\n\n5.  **Granularity of Details:** The feedback noted that minor details were included that detracted from the plot summary. The prompt did not provide guidance on filtering these.\n\n    *   **Improvement:** Add a constraint to focus on significant plot points. \"Omit minor details, descriptive adjectives, or tangential information that do not directly contribute to understanding the main sequence of events and the central conflict. Focus only on what is essential to understand the plot's progression.\"\n\n**Revised Prompt Structure Suggestion:**\n\nThe prompt should be more focused on the *narrative structure* and *plot progression*.\n\n**Core Change:** Shift from \"synthesize plot elements\" to \"construct a chronological plot narrative.\"\n\n**Modified Instructions:**\n\n1.  **Understand the Query:** Analyze `{}`. Your summary must directly address this query, focusing on the story's events.\n2.  **Construct a Chronological Narrative:**\n    *   **Identify Protagonist(s) & Central Conflict:** Who is the main character(s), and what is the primary problem or goal driving the story?\n    *   **Sequence of Events:** Detail the main plot points *in the order they occur*. Describe the setup, rising action, key turning points, climax, and resolution.\n    *   **Cause and Effect:** Explain how events lead to subsequent events and impact characters.\n    *   **Character Actions & Motivations:** Focus on what characters *do* and *why*, as this drives the plot. Clarify their roles and relationships.\n3.  **Focus on Plot Drivers:** Prioritize actions and events that propel the narrative. Distinguish between descriptions of entities/settings and their roles/interactions within the plot.\n4.  **Filter for Significance:** Include only details essential for understanding the plot's progression. Omit minor descriptive elements or tangential information.\n5.  **Maintain Coherence & Conciseness:** Ensure a logical flow and avoid repetition.\n\nThis revised approach would more effectively guide the LLM to extract and synthesize information into a coherent, sequential plot summary, directly addressing the weaknesses identified.",
  "graph_builder_prompt": "\nYou will be given a text. Your goal is to identify entities in the text and all the relationships among the identified entities.\nFor each entity, you will include:\n- name: the entity name\n- type: the entity type (e.g., Person, Organization, Location, Event, Concept)\n- properties: a list of key-value pairs describing characteristics of the entity extracted from the text (e.g., for a person: age, role, description; for a location: description, significance). Each property should have a \"key\" and \"value\" field.\n\nFor each relationship, you will include its type, a description (why you think the two entities are related to each other), and the evidence from the text that supports this.\nThe relationships must be among the extracted entities.\nProvide a list of triplets in your answer.\n\nReturn no more than 20 entities and 30 relationships. \n\nText:\n{TEXT_CHUNK}\n\nProvide the reasoning that led to your response.\n",
  "retrieval_prompt": "\nYou are an agentic retrieval component of a community-based GraphRAG system. Your goal is to select the most relevant communities from the knowledge graph to answer the following query: What is the plot of the story?.\nYou can select more than one community. \n\nAvailable Communities:\n{RETRIEVED_CONTEXT}\n\nSelect the communities that are most relevant to answering the query. Choose communities that together provide comprehensive coverage of the information needed.\n\nProvide the list of community IDs you want to retrieve and explain your reasoning for selecting these specific communities.\n"
}