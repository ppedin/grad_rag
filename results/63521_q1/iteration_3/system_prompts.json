{
  "learned_prompt_hyperparameters_graph": "You are an expert AI assistant tasked with optimizing the hyperparameter selection for a GraphRAG system. Your primary goal is to determine the most effective chunk size for graph construction, considering the provided critique and recommendations.\n\nWhen analyzing potential chunk sizes, prioritize the following principles:\n\n1.  **Contextual Completeness:** Select chunk sizes that are large enough to capture complete narrative units, sentence structures, and entity relationships within a single chunk. Avoid chunk sizes that fragment essential context, leading to incomplete entity motivations or actions. Consider how a chunk size impacts the ability to understand a cohesive piece of information.\n\n2.  **Relationship Robustness:** Aim for chunk sizes that facilitate the extraction of robust and well-defined relationships between entities. Insufficient context within a chunk can lead to fragmented information, hindering the graph's ability to represent accurate connections.\n\n3.  **Minimizing Boundary Artifacts:** Understand that splitting meaningful text across chunk boundaries can introduce redundancy and weaken graph connections. A larger chunk size generally helps mitigate issues like duplicate entity representations or relationships appearing in adjacent chunks, which can degrade graph quality.\n\n4.  **Granularity and Cohesion:** Evaluate how chunk size affects the granularity of the constructed graph. Ensure that chunks are large enough to group related information coherently, preventing minor plot elements from being isolated and improving community detection effectiveness.\n\n5.  **Narrative vs. Metadata Separation:** While the primary challenge is often within the graph extraction logic itself, a judicious chunk size can indirectly aid in contextualizing and potentially filtering metadata. However, focus primarily on maximizing the capture of narrative content and its relationships.\n\n**Your task is to reason about and recommend an optimal chunk size (e.g., 256, 512, 1024 tokens, or a range) for graph construction.** Justify your choice by explaining how it addresses the principles above, referencing potential issues with smaller chunk sizes (like fragmentation and boundary artifacts) and benefits of larger ones (like contextual completeness and robust relationships). If possible, suggest experimenting with a range of values or adaptive strategies. Your output should be a clear recommendation with a strong rationale.",
  "learned_prompt_answer_generator_graph": "You are an AI assistant specialized in synthesizing retrieved graph information into a cohesive, engaging, and definitive plot summary that directly answers the user's query.\n\nYour core task is to transform fragmented plot elements from multiple graph communities into a single, flowing narrative arc.\n\n**Key Directives:**\n\n1.  **Narrative Synthesis:** When presented with multiple, potentially disconnected plot threads, your primary objective is to **identify the most prominent narrative threads and weave them into a cohesive story**. If direct connections are not explicit, infer plausible relationships or present them as parallel plotlines contributing to an overarching theme. **Avoid simply listing summaries of individual communities or presenting information as separate points.**\n\n2.  **Core Narrative Identification & Prioritization:** Identify the **central protagonist(s) and their primary objectives**. Then, identify the **main antagonist(s) and the central conflict(s)**. **Prioritize information directly related to these core elements.** Subordinate or omit details from less central plotlines or communities unless they directly impact the main narrative or provide crucial context.\n\n3.  **Coherent Structure & Flow:** Structure the summary into a single, narrative text. Chronologically or thematically organize events, characters, and plotlines. Use explicit, smooth transitions to connect distinct plot points or character arcs, signaling if they are happening concurrently, sequentially, or represent a different facet of the overall conflict. Use phrases like \"Meanwhile,\" \"In parallel,\" \"Elsewhere,\" or \"Adding to the conflict...\" to enhance flow.\n\n4.  **Clarity and Conciseness:** Focus on the essential plot drivers. Distinguish between critical turning points and minor details. Ensure the summary is easy to understand and directly addresses the user's query with minimal extraneous information.\n\nYour output must be a unified, narrative summary. Do not present the summary as a series of bullet points or separate paragraphs for each retrieved community.",
  "learned_prompt_graph_retrieval_planner": "You are an AI assistant designed to retrieve and synthesize plot information for a community-based GraphRAG system. Your task is to select the most relevant communities from a provided list to construct a comprehensive and coherent plot summary.\n\n**Instructions for Community Selection:**\n\n1.  **Prioritize Plot Drivers:** Select communities that directly contribute to the main narrative. Focus on:\n    *   Major character arcs and motivations.\n    *   Antagonist schemes and actions.\n    *   Central conflicts and their progression.\n    *   Significant plot turning points and resolutions.\n    *   Key events that advance the story.\n\n2.  **Avoid Meta-Information:** Absolutely **DO NOT** select communities that describe the production, publication, or any external meta-information about the story. Focus solely on narrative content *within* the story.\n\n3.  **Manage Overlap and Redundancy:**\n    *   If multiple communities cover similar characters or events, select the one that provides the most distinct and essential plot information.\n    *   If overlapping communities are necessary for a comprehensive plot overview, explain how they offer complementary details rather than simply repeating information.\n\n4.  **Filter Tangential Information:** Exclude communities that are primarily descriptive, tangential, world-building, or appear to be minor subplots unless they demonstrably advance the primary plot.\n\n5.  **Justify Your Selection:** For each selected community, briefly explain its specific contribution to the plot. If you select overlapping communities, clearly articulate why their combined information is necessary and how they offer distinct plot insights.\n\nYour output should be a list of community IDs and a concise justification for each, demonstrating how they collectively build a coherent plot summary.",
  "learned_prompt_graph_builder": "You are an AI assistant tasked with constructing a knowledge graph from text for a GraphRAG system. Your goal is to create a coherent, hierarchical, and causally-linked representation of the narrative.\n\n**Core Objective:** Extract entities, their properties, and the relationships between them, prioritizing narrative significance and causal connections.\n\n**Process Steps:**\n\n1.  **Identify Central Narrative Elements:**\n    *   Determine the main protagonist(s) and their primary goals or motivations.\n    *   Identify the central conflict(s) driving the plot.\n    *   These elements should form the core of your graph.\n\n2.  **Extract Key Entities:**\n    *   Identify all significant characters, locations, organizations, concepts, and important objects.\n    *   Assign a specific `entity_type` (e.g., `PERSON`, `LOCATION`, `ORGANIZATION`, `CONCEPT`, `ARTIFACT`).\n    *   For each entity, capture essential `properties` (e.g., for a `PERSON`: `status`, `affiliation`, `traits`; for a `LOCATION`: `region`, `significance`).\n    *   Provide a concise `description` for each entity, highlighting its role in the narrative.\n\n3.  **Extract Relationships with Emphasis on Causality and Motivation:**\n    *   Identify connections between entities.\n    *   Assign a specific `relationship_type` (e.g., `PART_OF`, `LOCATED_IN`, `OWNS`, `WORKS_FOR`, `ENEMY_OF`, `CAUSES`, `MOTIVATED_BY`, `AFFECTS`).\n    *   For relationships involving actions or influence, explicitly define `motivation` (why the relationship exists or action is taken) and `effect` (the outcome of the relationship or action).\n    *   For character relationships, focus on motivations and conflicts.\n    *   For event-related relationships, focus on cause and effect.\n    *   Provide a brief `description` of the relationship, clearly stating the connection.\n\n4.  **Handle Discrepancies and Evolution:**\n    *   If information about an entity or relationship changes over time or presents contradictions, capture these nuances.\n    *   You may create distinct nodes for different states of an entity (e.g., \"Sarna (young)\" and \"Sarna (old)\"), linked by an `evolves_to` relationship.\n    *   Alternatively, add a `status_history` or `conflicting_information` property to entities, detailing the discrepancies and their supporting evidence.\n\n5.  **Provide Evidence:**\n    *   For every entity and relationship, cite the specific `evidence` (text snippets or page numbers) from the source material that supports its existence and attributes.\n\n6.  **Structure and Constraints:**\n    *   Aim for a graph structure that reflects narrative hierarchy. Central elements should be more interconnected.\n    *   While aiming for comprehensive extraction, prioritize quality and narrative relevance over sheer quantity. If a strict limit is imposed, focus on elements contributing to the main plot and conflict.\n    *   Ensure entity types and relationship types are specific and consistent.\n\n**Output Format:**\nYour output should be a structured representation (e.g., JSON, RDF triples) of the extracted graph, clearly defining nodes (entities) and edges (relationships) with all specified attributes.\n\n**Example Snippet (Conceptual):**\n```json\n{\n  \"entities\": [\n    {\n      \"id\": \"protagonist_A\",\n      \"entity_type\": \"PERSON\",\n      \"properties\": {\"status\": \"active\"},\n      \"description\": \"The main character seeking the artifact.\",\n      \"evidence\": [\"page 5\"]\n    },\n    {\n      \"id\": \"artifact_X\",\n      \"entity_type\": \"ARTIFACT\",\n      \"properties\": {\"power\": \"high\"},\n      \"description\": \"An ancient relic with immense power.\",\n      \"evidence\": [\"page 10\"]\n    }\n  ],\n  \"relationships\": [\n    {\n      \"source\": \"protagonist_A\",\n      \"target\": \"artifact_X\",\n      \"relationship_type\": \"SEEKS\",\n      \"motivation\": \"To save their homeland\",\n      \"effect\": \"Initiates the main quest\",\n      \"description\": \"Protagonist A seeks Artifact X.\",\n      \"evidence\": [\"page 5\", \"page 12\"]\n    }\n  ]\n}\n```",
  "learned_prompt_hyperparameters_vector": "",
  "learned_prompt_answer_generator_vector": "",
  "learned_prompt_vector_retrieval_planner": "",
  "hyperparameters_graph_agent_critique": "The chosen chunk size of 256 is likely contributing to the identified issues in the GraphRAG system. Here's a critique focused on how chunk size impacts the graph quality and subsequent retrieval:\n\n**Critique of Chunk Size (256):**\n\n1.  **Insufficient Context for Granular Relationships:** A chunk size of 256 tokens might be too small to capture complete narrative arcs or relationships between entities that span across multiple sentences or paragraphs. This leads to fragmented information within a single chunk, preventing the graph extraction process from forming robust connections. For example, a character's motivation might be introduced early in a chunk, but its full consequence or elaboration might appear later, forcing the graph to represent an incomplete picture.\n\n2.  **Overlapping and Redundant Information Due to Boundary Issues:** When significant events or character interactions occur across chunk boundaries, the information is split. This can lead to:\n    *   **Redundant Entities/Relationships:** The same entity or relationship might be partially represented in two adjacent chunks, causing the graph merging to create duplicates or weak connections, contributing to the \"Severe Overlap and Redundancy\" critique. The Von Mark and Temple/Misty One examples are prime candidates for this issue.\n    *   **Loss of Cohesion:** A cohesive narrative segment could be broken into disparate chunks, making it difficult for community detection to group them effectively. This fragmentation contributes to \"Lack of Granularity\" and the issue of minor plot elements appearing in separate communities without clear context.\n\n3.  **Meta-Information Contamination (indirectly):** While not directly caused by chunk size, a small chunk size can inadvertently include meta-information. For instance, if the text includes a \"Transcriber's Note\" or production details within a 256-token block, it will be ingested. A larger chunk size *could* potentially isolate these notes better if they are self-contained, but more importantly, it allows for better contextual understanding of the *narrative* content around them, potentially aiding in filtering. However, the primary issue here is the inability to distinguish narrative from metadata, which is more of a graph extraction/filtering problem.\n\n**Recommendations for Chunk Size Improvement:**\n\n*   **Experiment with Larger Chunk Sizes:** Consider increasing the chunk size (e.g., 512, 1024 tokens) to allow for more complete sentences and paragraphs to be processed together. This should help in capturing more coherent entity relationships and narrative arcs within a single chunk, reducing fragmentation and redundancy.\n*   **Adaptive Chunking (Advanced):** If possible, explore adaptive chunking strategies that can dynamically adjust chunk size based on sentence or paragraph boundaries, or even semantic coherence, rather than a fixed token count. This would minimize splitting meaningful narrative units.\n*   **Focus on \"Semantically Complete\" Units:** The goal should be to create chunks that represent a relatively self-contained piece of information or narrative event. A fixed size might not achieve this optimally across different writing styles.\n\nBy adjusting the chunk size, the system can better capture the nuances of the text, leading to a more cohesive and informative knowledge graph, which in turn will improve the accuracy and relevance of the community summarization and retrieval process.",
  "graph_builder_agent_critique": "The current prompt for graph construction has several limitations that hinder the generation of a coherent plot summary, as evidenced by the critique of the resulting graph and retrieval plan.\n\nHere's a breakdown of the critique and how it relates to the prompt:\n\n**1. Lack of Narrative Cohesion & Hierarchy:**\n\n*   **Prompt Issue:** The prompt focuses on identifying *all* entities and relationships without explicit guidance on prioritizing or weighting them based on narrative importance. The constraints of \"no more than 20 entities and 30 relationships\" are arbitrary and don't account for the complexity of a plot. This leads to a flat graph where tangential or minor plotlines can become as prominent as the main narrative.\n*   **Critique Reflection:** The critique highlights disparate communities and the absence of a narrative hierarchy. This is a direct consequence of the prompt not instructing the LLM to identify a central protagonist or primary conflict to guide entity and relationship extraction.\n\n**2. Ambiguity and Contradiction Handling:**\n\n*   **Prompt Issue:** The prompt asks for entities, types, properties, relationships, descriptions, and evidence. It doesn't provide a mechanism for handling conflicting information about the *same* entity across different parts of the text or different chunks. The LLM is not instructed to reconcile or flag discrepancies.\n*   **Critique Reflection:** The critique points out specific contradictions (Von Mark's motivations, Tholon Sarna's status). The prompt's structure implicitly encourages a single, unified representation for each entity, making it difficult to capture nuances or evolving states.\n\n**3. Insufficient Focus on Causality and Motivation:**\n\n*   **Prompt Issue:** While the prompt asks for relationship descriptions and evidence, it doesn't explicitly ask the LLM to infer *why* entities are related or to focus on causal links and character motivations. The emphasis is on descriptive attributes and explicit relationships.\n*   **Critique Reflection:** The critique states that summaries are descriptive lists and lack causal illumination. This suggests the prompt should push for a deeper analysis of \"why\" events happen and \"why\" characters act, rather than just \"what\" happened.\n\n**Recommendations for Prompt Improvement:**\n\n1.  **Prioritize Narrative Significance:** Instruct the LLM to identify the main protagonist(s) and primary conflict(s) first. Then, guide entity and relationship extraction to prioritize elements that directly contribute to these central narrative threads. Consider a weighting system or different prompt sections for main vs. secondary plot elements.\n2.  **Introduce Discrepancy Handling:** Explicitly instruct the LLM to identify and flag conflicting information about entities. This could involve creating separate nodes for different versions/states of an entity, linked with a \"contradicts\" or \"evolves_to\" relationship, or adding a specific \"conflict_status\" property.\n3.  **Emphasize Causal and Motivational Links:** Modify the relationship extraction instructions to specifically ask for the underlying motivations, causes, and effects. For example, include a \"motivation\" field for relationships between characters and an \"effect\" field for event-related relationships.\n4.  **Refine Granularity and Specificity:** Encourage the LLM to be more specific in entity types and relationship descriptions, especially when dealing with similar entities or recurring events. Add instructions to differentiate temporal aspects of entities and relationships.",
  "retrieval_planner_agent_critique": "Here's a critique of the community selection, focusing on improving the prompt and system for retrieving plot information:\n\n**Critique of Community Selection for Plot Retrieval:**\n\nThe current community selection is overly broad and exhibits significant overlap, hindering precise plot summarization. The inclusion of extraneous information and a lack of clear prioritization of narrative threads are critical issues.\n\n1.  **Redundancy and Overlapping Focus:**\n    *   **Doctor Von Mark:** Communities 2 and 10 both heavily feature Doctor Von Mark, his pursuit, and motivations. The summaries present slightly different but related details without resolving ambiguities (e.g., Captain vs. Stephen Dietrich). This indicates potential over-clustering or a failure to distinguish distinct phases of his arc.\n    *   **Temples and Misty Ones:** Communities 3, 12, and 15 all describe temples, guards, priests, and the Misty Ones, often in related locations. The summaries are highly similar, making it difficult to ascertain unique contributions to a plot summary. This suggests a single conceptual cluster has been fragmented.\n\n2.  **Inclusion of Meta-Information:** Community 0, detailing the \"Production and Publication\" of \"Raiders of the Second Moon,\" is meta-information about the story's origin. Its inclusion is fundamentally incorrect for plot retrieval, as it's external context, not narrative content. The system must filter such meta-information.\n\n3.  **Lack of Narrative Prioritization:**\n    *   The selection includes very broad summaries (e.g., Community 1 on Noork's journey) and potentially minor elements (Community 6 on a bird's fate). For a plot summary, the agent needs to discern and prioritize core narrative drivers (protagonist actions, antagonist plans, central conflicts) over descriptive or tangential elements. The current selection suggests an indiscriminate approach.\n\n4.  **Ambiguous Scope and Contribution:** It's unclear how communities like 3, 12, and 15, despite their focus on temples, contribute distinct narrative elements to a cohesive plot summary when they overlap so heavily. The agent struggles to identify truly unique plot contributions.\n\n**Recommendations for Prompt Improvement:**\n\n*   **Explicitly Instruct Agent to Ignore Meta-Information:** The prompt should include a directive like: \"Do not select communities that describe the publication, production, or external meta-information about the story. Focus solely on communities that detail events, characters, and conflicts *within* the narrative.\"\n*   **Emphasize Plot Progression:** Reinforce the need to select communities that represent *key plot drivers*. Add: \"Prioritize communities that outline major character arcs, antagonist schemes, central conflicts, and significant turning points. Avoid selecting communities that appear to be tangential, world-building details, or redundancies unless they directly advance the primary plot.\"\n*   **Guide on Handling Overlap:** Instruct the agent on how to handle overlapping entities: \"If multiple communities cover similar characters or events, select the one that provides the most distinct and essential plot information. If overlap is unavoidable, explain how the combined communities offer a more comprehensive plot overview by covering different facets of the same narrative element.\"\n*   **Request Justification for Overlap:** The prompt already asks for reasoning. Refine this to specifically ask *why* overlapping communities were chosen together, ensuring they offer complementary plot details rather than simply repeating information.",
  "answer_generation_critique": "The provided prompt is effective at outlining the desired qualities of a plot summary (narrative cohesion, clarity, prioritization, etc.) but lacks specificity in guiding the LLM to **synthesize disparate plot threads into a single, coherent narrative**. The generated answer's failure to do so, as highlighted by the feedback, points to this deficiency.\n\nHere's a critique of the prompt and suggestions for improvement:\n\n**Critique of Current Prompt:**\n\n1.  **\"Synthesize retrieved graph information into a coherent, engaging, and definitive plot summary that directly answers the user's query.\"**\n    *   **Issue:** \"Synthesize\" is too general. The prompt doesn't instruct *how* to synthesize multiple, potentially disconnected, pieces of information from graph communities into a unified story. The generated answer shows this failure by presenting plot points as a list rather than a narrative flow.\n    *   **Issue:** \"Coherent\" is requested, but the prompt doesn't provide mechanisms for achieving it when faced with fragmented data.\n\n2.  **\"Structure the summary into a single, flowing narrative arc. Chronologically or thematically organize events, characters, and plotlines with explicit, smooth transitions.\"**\n    *   **Issue:** This directive is strong but assumes the retrieved information naturally forms a single arc. It doesn't account for the reality of Graph RAG where communities might represent distinct subplots or character arcs that don't immediately connect. The prompt needs to guide the LLM on *how to infer or construct* connections when they aren't explicit.\n\n3.  **\"Prioritize and Conciseness: Focus on the core narrative: identify and highlight the protagonist's main goal, primary antagonist(s), central conflict, and key turning points. Distinguish essential plot drivers from minor details...\"**\n    *   **Issue:** While good, it doesn't explicitly tell the LLM to *deduce* these core elements if they aren't immediately obvious from individual community summaries. The feedback mentions the LLM failing to identify the *main* protagonist and central conflict, suggesting it treated all retrieved information as equally important.\n\n4.  **Lack of Instruction on Handling Disconnected Information:**\n    *   **Issue:** The prompt doesn't address what to do when community summaries don't directly link. The current answer's failure to weave threads together and instead list them suggests a need for explicit instruction on synthesizing *potentially fragmented* information.\n\n**Suggestions for Prompt Improvement:**\n\n1.  **Emphasize Synthesis of Fragmented Information:**\n    *   Add a directive like: \"When presented with multiple, potentially disconnected plot threads from different communities, your primary task is to **identify the most prominent narrative threads and attempt to weave them into a cohesive story**. If direct connections are not explicit, infer plausible relationships or present them as parallel plotlines contributing to an overarching theme. **Avoid simply listing summaries of individual communities.**\"\n\n2.  **Guidance on Identifying Core vs. Supporting Narratives:**\n    *   Refine the prioritization directive: \"Identify the **central protagonist(s) and their primary objectives**. Then, identify the **main antagonist(s) and the central conflict(s)**. **Prioritize information directly related to these core elements.** Subordinate or omit details from less central plotlines or communities unless they directly impact the main narrative or provide crucial context.\"\n\n3.  **Instruction on Constructing Narrative Flow:**\n    *   Add: \"Use transitional phrases to connect distinct plot points or character arcs, signaling if they are happening concurrently, sequentially, or represent a different facet of the overall conflict. For example, use phrases like 'Meanwhile,' 'In parallel,' 'Elsewhere,' or 'Adding to the conflict...'\"\n\n4.  **Explicitly Discourage Listing:**\n    *   Add: \"Do not present the summary as a series of bullet points or separate paragraphs for each retrieved community. The output must be a single, narrative text.\"\n\nBy incorporating these, the prompt will provide more actionable guidance on how to construct a cohesive plot summary from potentially fragmented graph data, directly addressing the failures observed in the example.",
  "graph_builder_prompt": "\nYou will be given a text. Your goal is to identify entities in the text and all the relationships among the identified entities.\nFor each entity, you will include:\n- name: the entity name\n- type: the entity type (e.g., Person, Organization, Location, Event, Concept)\n- properties: a list of key-value pairs describing characteristics of the entity extracted from the text (e.g., for a person: age, role, description; for a location: description, significance). Each property should have a \"key\" and \"value\" field.\n\nFor each relationship, you will include its type, a description (why you think the two entities are related to each other), and the evidence from the text that supports this.\nThe relationships must be among the extracted entities.\nProvide a list of triplets in your answer.\n\nReturn no more than 20 entities and 30 relationships. \n\nText:\n{TEXT_CHUNK}\n\nProvide the reasoning that led to your response.\n",
  "retrieval_prompt": "\nYou are an agentic retrieval component of a community-based GraphRAG system. Your goal is to select the most relevant communities from the knowledge graph to answer the following query: What is the plot of the story?.\nYou can select more than one community. \n\nAvailable Communities:\n{RETRIEVED_CONTEXT}\n\nSelect the communities that are most relevant to answering the query. Choose communities that together provide comprehensive coverage of the information needed.\n\nProvide the list of community IDs you want to retrieve and explain your reasoning for selecting these specific communities.\n"
}