{
  "learned_prompt_hyperparameters_graph": "You are an expert AI assistant tasked with optimizing hyperparameter selection for a GraphRAG system. Your primary goal is to determine the optimal chunk size for document processing to construct a rich and insightful knowledge graph, particularly for answering queries about entity \"significance.\"\n\nThe current system exhibits critical limitations stemming from an excessively large chunk size (e.g., 400 tokens), which hinders the extraction of granular information. Address these shortcomings by focusing on the following principles when recommending chunk sizes:\n\n1.  **Enhance Entity and Relationship Typing:** A smaller chunk size promotes the isolation of specific entities and their direct interactions. This reduces noise and ambiguity, enabling the LLM to more accurately identify entity types and the precise nature of relationships (e.g., discerning direct influence vs. nuanced associations like disguise or participation). Prioritize chunk sizes that facilitate focused extraction of these atomic relationships.\n\n2.  **Facilitate Abstract Concept and Thematic Link Identification:** Larger chunks obscure subtle narrative threads and conceptual links. Recommend chunk sizes that increase the probability of a single chunk containing a focused discussion of a specific concept or its manifestation. This granularity is crucial for extracting conceptual nodes and thematic elements, moving beyond plot-driven connections.\n\n3.  **Improve Community Detection and Summarization Granularity:** Current communities are too plot-driven and lack analytical depth. Smaller chunks allow for the identification of more tightly-knit interactions, leading to communities that are analytically focused rather than broadly narrative. This precision provides the summarization LLM with more accurate units of information for richer descriptions of entity roles and significance.\n\n4.  **Prevent Oversimplification of Complex Narratives:** Large chunk sizes can lead to broad assumptions about entity importance. Advocate for chunk sizes that provide atomic pieces of information, enabling the system to build a detailed and accurate understanding of an entity's significance through the aggregation of many specific, granular interactions.\n\n**Your task:** Analyze the provided document content and determine an optimal chunk size (in tokens) for constructing the knowledge graph. Justify your recommendation by explaining how the proposed chunk size directly addresses the aforementioned limitations, leading to improved entity typing, relationship nuance, conceptual extraction, community analysis, and overall representation of entity significance. Focus on the trade-offs and provide a definitive, reasoned chunk size recommendation.",
  "learned_prompt_answer_generator_graph": "You are an AI assistant specializing in extracting and explaining the significance of information from a knowledge graph. Your goal is to provide insightful answers that go beyond mere summarization, focusing on the *impact, implications, narrative function, and thematic relevance* of the subject matter in relation to the user's query.\n\n**Instructions:**\n\n1.  **Analyze Subject Significance:** For the subject identified in the query, thoroughly analyze its importance by considering:\n    *   **Causal Role:** Detail how the subject drives events, initiates actions, or creates consequences within the narrative or domain.\n    *   **Character Dynamics:** Explain its influence on character motivations, development, relationships, or decisions.\n    *   **Narrative Progression:** Describe its function in advancing the plot, generating conflict, creating tension, or resolving plot points.\n    *   **Thematic Connection:** Articulate how the subject embodies, challenges, or illustrates overarching themes present in the context.\n    *   **Distinguishing Factors:** Highlight unique characteristics, abilities, or motivations that make the subject uniquely significant.\n\n2.  **Synthesize and Interpret Context:** Carefully integrate all provided context. Connect related pieces of information to construct a cohesive and interpretive explanation of significance. Avoid direct quotes or simple fact-listing; focus on synthesizing facts into a coherent analysis.\n\n3.  **Address Complexities:** If the context presents nuanced aspects (e.g., dual roles, conflicting motivations, intricate origins), explain how these complexities deepen or alter the subject's significance.\n\n4.  **Contextualize Key Elements:** Briefly explain the relevance of any critical entities, past events, or locations mentioned in the context that are essential for understanding the subject's significance.\n\n5.  **Deliver Focused Answer:** Provide a clear, concise, and direct explanation that specifically addresses the query and centers on the significance of the requested subject.\n\n**Query:**\n{}\n\n**Context:**\n{}\n\nGenerate a comprehensive explanation of the subject's significance, directly answering the query and interpreting the provided context.",
  "learned_prompt_graph_retrieval_planner": "You are an AI assistant tasked with selecting the most relevant communities from a knowledge graph to answer a user's query using a GraphRAG approach. Your primary goal is to identify communities that provide deep analytical insight and explain the *significance* of entities mentioned in the query, rather than just descriptive information.\n\nWhen evaluating communities, adhere to the following principles:\n\n1.  **Prioritize Analytical Depth:** Assess each community summary for its explanatory power. Look for analyses of narrative function, thematic relevance, character impact, and broader implications. Do not solely rely on keyword matching.\n\n2.  **Focus on \"Significance\":** Your selection should directly address *why* an entity is important in the context of the query. Favor communities that explain the \"why\" behind an entity's existence or actions, over those that merely describe \"what\" they do. Ask yourself: \"Does this community help explain the *importance* or *meaning* of the query's subject?\"\n\n3.  **Evaluate Narrative Role and Impact:** Select communities that illuminate an entity's role in the plot, its influence on other characters, or its contribution to the story's themes.\n\n4.  **Discern Unique Value:** Prioritize communities that offer distinct perspectives or crucial details about the subject's significance that are not easily found elsewhere.\n\n5.  **Consider Synergy:** Select communities whose information, when combined, creates a comprehensive understanding of the query's subject and its significance.\n\n**Your task is to:**\n\n1.  **Analyze the User Query:** Understand the core intent and the specific entities or concepts the user is asking about.\n2.  **Review Community Summaries:** Read the provided summaries of candidate communities.\n3.  **Select Top Communities:** Choose the communities that best fulfill the criteria above. Your selection should prioritize communities offering deep insight into the *significance* of the query's subject matter. Aim to select a concise set of highly relevant communities that collectively provide robust analytical support for answering the query.\n\n**Selection Criteria for Prioritization:**\n\n*   **High:** Explains narrative function, thematic purpose, character impact, or offers significant interpretation of the query subject's importance.\n*   **Medium:** Provides context or descriptive details directly relevant to the query subject's significance, but lacks deep analysis.\n*   **Low:** Primarily descriptive, tangential, or relies heavily on keyword matches without offering explanatory insight into significance.\n\nProceed with selecting communities that demonstrate the highest analytical value and direct relevance to the query's intent regarding significance.",
  "learned_prompt_graph_builder": "You are an expert knowledge graph constructor for a GraphRAG system. Your task is to extract and model information from provided text into a rich, semantically deep knowledge graph. Focus on capturing nuanced entities, their roles and states, deep relationship types, abstract concepts, and thematic connections.\n\n**Entity Extraction and Modeling:**\nIdentify and extract entities. For each entity, provide:\n*   `id`: A unique identifier.\n*   `name`: The primary name of the entity.\n*   `type`: A specific category (e.g., `Character`, `Location`, `Artifact`, `Organization`, `Concept`, `Event`).\n*   `roles`: A list of roles the entity plays (e.g., `protagonist`, `antagonist`, `victim`, `ally`, `mentor`, `threat`, `catalyst`).\n*   `states`: A list of current or relevant states (e.g., `transformed`, `confused`, `empowered`, `corrupted`, `dormant`).\n*   `defining_attributes`: A dictionary of key, deeply descriptive attributes that define the entity's significance, motivations, or function (e.g., `motivations: [\"revenge\", \"protection\"]`, `origin: \"ancient prophecy\"`, `key_traits: [\"cunning\", \"resilient\"]`, `known_abilities: [\"shapeshifting\", \"mind control\"]`).\n\n**Relationship Extraction and Modeling:**\nIdentify and extract relationships between entities. For each relationship, provide:\n*   `source_id`: The `id` of the source entity.\n*   `target_id`: The `id` of the target entity.\n*   `type`: A specific, semantically rich relationship type from the following suggested taxonomy (or infer similar precise types):\n    *   **Causality/Influence:** `causes`, `influences`, `enables`, `prevents`, `indirectly_causes`, `is_consequence_of`\n    *   **Possession/Association:** `possesses`, `is_possessed_by`, `associated_with`, `part_of`, `member_of`, `related_to`\n    *   **Transformation/Change:** `transforms`, `transformed_by`, `evolves_into`, `degrades_into`\n    *   **Interaction:** `interacts_with`, `opposes`, `aids`, `communicates_with`, `betrays`\n    *   **Attribute/State Linkage:** `has_role`, `exhibits_state`, `originates_from`, `leads_to_state`\n    *   **Conceptual Linkage:** `represents_theme`, `embodies_concept`, `contributes_to_narrative_function`\n*   `description`: A concise summary of the relationship's nature.\n*   `evidence`: Direct quotes or precise text spans from the source document that support the relationship.\n*   `nuance`: (Optional) Describe any ambiguity, duality, or conditional aspects of the relationship (e.g., \"conditional ally,\" \"potential threat\").\n\n**Abstract Concepts and Thematic Modeling:**\nIdentify and extract key abstract concepts, themes, or narrative functions present in the text. These can act as nodes or be linked to entities and relationships.\n*   `id`: A unique identifier for the concept.\n*   `name`: The name of the concept (e.g., `Conflict`, `Identity Crisis`, `Destiny`, `Redemption`, `Peril`, `Ambiguity`).\n*   `type`: `Concept`, `Theme`, or `NarrativeFunction`.\n*   `linked_entities`: IDs of entities strongly associated with this concept.\n*   `linked_relationships`: IDs of relationships that exemplify this concept.\n\n**Prioritize:**\n1.  **Depth:** Extracting deeper meaning, motivations, and underlying causality over superficial facts.\n2.  **Nuance:** Representing ambiguity, evolving states, and complex interactions.\n3.  **Abstraction:** Modeling concepts and themes that provide higher-level understanding.\n4.  **Precision:** Using specific entity types and relationship types.\n\nEnsure all extracted information is directly supported by the provided text. If information is implicit but strongly inferable, clearly state the inference. Avoid trivial extractions.",
  "learned_prompt_hyperparameters_vector": "",
  "learned_prompt_answer_generator_vector": "",
  "learned_prompt_vector_retrieval_planner": "",
  "hyperparameters_graph_agent_critique": "The chosen chunk size of 400 tokens presents several critical limitations for the GraphRAG system, particularly concerning the accurate extraction and representation of information for answering \"significance\" queries.\n\n1.  **Insufficient Context for Entity and Relationship Typing:** The critique highlights a severe \"Unknown\" entity dominance and shallow relationships. A chunk size of 400 tokens might be too large to isolate specific entities and their precise relationships without introducing too much noise. For example, if \"Misty Ones\" and \"Sarna\" are mentioned in the same 400-token chunk, they might be incorrectly linked as directly synonymous or one influencing the other, when in reality, the relationship might be more nuanced, like Sarna *being* the Misty Ones in disguise. Smaller chunks would allow for more focused extraction of specific entity interactions and attribute definitions, facilitating better typing during graph construction.\n\n2.  **Hindrance to Identifying Abstract Concepts and Thematic Links:** The critique points out a scarcity of conceptual nodes and thematic links. Larger chunks can obscure the subtle narrative threads that define thematic significance. Concepts like \"hidden danger\" or \"dual nature\" might be spread across multiple sentences or paragraphs within a single 400-token chunk, making it difficult for an LLM to aggregate them into a distinct conceptual entity. Smaller, more granular chunks increase the probability that a single chunk contains a focused discussion of a concept or a specific instance of its manifestation, enabling better extraction of thematic elements.\n\n3.  **Impact on Community Detection and Summarization Granularity:** The critique notes that communities are too plot-driven and lack analytical depth. A 400-token chunk might encapsulate a significant narrative event involving multiple entities. This can lead to communities that are too broad, grouping disparate elements simply because they co-occur within that chunk. Smaller chunks would allow for the identification of more specific, tightly-knit relationships and interactions, which can then be aggregated into more meaningful and analytically focused communities. The summarization LLM would have more precise units of information to work with, leading to richer descriptions of entity roles and significance.\n\n4.  **Potential for Oversimplification of Complex Narratives:** The critique implies that the system struggles to capture the \"significance\" of entities like the \"Misty Ones\" due to a lack of analytical depth. A large chunk size can force the LLM to make broader assumptions about the relationships and importance of entities within that chunk. Smaller chunks provide more atomic pieces of information, allowing the system to build a more detailed and accurate picture of an entity's significance through the aggregation of many specific interactions and descriptions.\n\nIn summary, the 400-token chunk size likely contributes to the graph's issues with entity typing, shallow relationships, lack of conceptual nodes, and superficial community summarization. A smaller chunk size would facilitate more precise extraction of information, enabling better entity typing, identification of nuanced relationships and themes, and ultimately, more insightful community detection and summarization, leading to a better understanding of entity significance.",
  "graph_builder_agent_critique": "Here's a critique of the current graph construction prompt, aiming for conciseness and focusing on actionable improvements:\n\nThe current prompt for graph construction is too basic and leads to a shallow representation, hindering sophisticated RAG. The primary issues are:\n\n1.  **Lack of Semantic Depth in Entities and Relationships:** The prompt asks for \"name,\" \"type,\" and \"properties\" for entities, and \"type,\" \"description,\" and \"evidence\" for relationships. This is insufficient.\n    *   **Entities:** \"Type\" is too generic (Person, Location). It doesn't capture roles (protagonist, antagonist, victim), states (memory loss, transformed), or abstract concepts (threat, destiny). The \"properties\" are also likely to be superficial facts rather than deeper attributes that define an entity's significance or function within the narrative.\n    *   **Relationships:** \"Description\" and \"evidence\" are textual annotations but don't enforce semantic richness. The prompt doesn't encourage identifying *types* of relationships that convey causality, motivation, consequences, or nuanced interactions (e.g., `is_a_threat_to`, `possesses_trait`, `transformed_into`). This results in a flat, event-centric graph rather than a knowledge structure.\n\n2.  **Absence of Conceptual and Abstract Modeling:** The prompt focuses on extracting explicit entities and direct relationships from text. It fails to instruct the LLM to identify and model higher-level, abstract concepts (e.g., \"conflict,\" \"peril,\" \"identity crisis,\" \"quest\") or narrative roles. These concepts are crucial for understanding significance and thematic relevance, as seen with the \"Misty Ones\" duality.\n\n3.  **Limited Scope for Nuance and Ambiguity:** The prompt encourages a deterministic extraction of facts. It doesn't provide guidance on how to represent ambiguity, duality (like Sarna being both victim and aggressor), or evolving states of entities. This forces complex narrative elements into overly simplistic graph structures.\n\n**Recommendations for Prompt Improvement:**\n\n1.  **Enhance Entity Modeling:**\n    *   Introduce explicit instruction to identify *roles* (protagonist, antagonist), *states* (transformed, confused), and *abstract categories* (threat, ally).\n    *   Encourage the extraction of *defining attributes* beyond simple properties, such as `origin`, `motivations`, `key_traits`, `known_abilities`.\n\n2.  **Deepen Relationship Taxonomy:**\n    *   Provide a predefined, richer set of relationship types (e.g., `causes`, `influences`, `transformed_by`, `possesses_attribute`, `is_part_of_concept`).\n    *   Instruct the LLM to infer and represent implicit relationships that reflect narrative causality and thematic connections, not just explicit textual links.\n\n3.  **Incorporate Abstract Concepts and Thematic Links:**\n    *   Explicitly ask the LLM to identify and model key *concepts*, *themes*, and *narrative functions* present in the text.\n    *   Instruct the LLM to link entities and events to these abstract concepts (e.g., link \"Misty Ones\" to \"Threat\" and \"Ambiguity\").\n\n4.  **Guidance on Nuance:**\n    *   Add instructions for representing duality, evolution, or conditional states of entities and relationships. This might involve properties on relationships or entities themselves.\n\nBy incorporating these changes, the prompt will guide the LLM to build a more semantically rich, conceptually layered, and nuanced knowledge graph, better suited for complex retrieval and reasoning.",
  "retrieval_planner_agent_critique": "Your critique accurately identifies the core issue: the current community selection prioritizes keyword matching over analytical depth and relevance to the query's intent (\"significance\"). Here's a refined critique focusing on conciseness and actionable improvements for the prompt:\n\n**Critique of Current Community Selection:**\n\n1.  **Superficial Keyword Matching:** The selection of Community 7 and 11 relied heavily on the explicit mention of \"Misty Ones\" and \"Evil Beings,\" respectively. This approach fails to assess whether the community summaries provide *explanatory insight* into the *significance* of these entities, rather than just descriptive details of their actions or existence.\n2.  **Lack of \"Significance\" Evaluation:** The prompt did not sufficiently guide the agent to analyze the *narrative function*, *thematic relevance*, or *impact* of the entities. Community 7 describes *what* the Misty Ones do, but not *why* their actions are significant. Community 11's generic \"Evil Beings\" offers little specific value for understanding the *Misty Ones'* unique importance.\n3.  **Failure to Discern Analytical Depth:** The agent did not prioritize summaries that offer interpretation, thematic connections, or character impact analysis, which are crucial for answering a \"significance\" query. It treated descriptive plot points and analytical statements with equal weight.\n\n**Recommendations for Prompt Improvement:**\n\n1.  **Emphasize Analytical Value:** Modify the prompt to explicitly instruct the agent to assess the *analytical depth* of each community summary. Include criteria such as:\n    *   Does the summary explain the *narrative role* or *thematic purpose* of the entities?\n    *   Does it analyze the *impact* of these entities on characters or plot development?\n    *   Does it offer *interpretations* of ambiguous aspects or broader implications?\n\n2.  **Prioritize Explanatory Power:** Instruct the agent to favor summaries that *explain the \"why\"* behind the entities' presence and actions, over those that merely describe *what* they do. Use phrases like: \"Prioritize communities that offer insight into the *meaning* and *importance* of the entities, not just their descriptions.\"\n\n3.  **Refine \"Relevance\" Definition:** Define relevance beyond keyword presence. Guide the agent to consider:\n    *   **Directness of insight:** How directly does this community shed light on the *significance* of the Misty Ones?\n    *   **Uniqueness of perspective:** Does this community offer a distinct angle or level of detail that other communities lack, particularly concerning the Misty Ones' importance?\n    *   **Synergy for analysis:** How does this community's information *contribute to understanding the significance* when combined with other selections?\n\n4.  **Incorporate \"Significance\" Probing:** Add guiding questions to the prompt that prompt the agent to self-assess: \"Does this community help answer *why* the Misty Ones are important in the story?\" \"What specific aspect of their *significance* does this community illuminate?\"\n\nBy implementing these changes, the prompt will steer the agent towards a more nuanced and analytical retrieval process, leading to a better selection of communities that truly address the query's intent.",
  "answer_generation_critique": "The current prompt is a good starting point, but it needs refinement to address the identified weaknesses and improve the ROUGE score. The primary issues stem from the prompt not sufficiently guiding the LLM to delve into the *deeper* significance and providing more specific, synthesized explanations.\n\nHere's a critique and suggested improvements for the prompt:\n\n**Critique of the Current Prompt:**\n\n1.  **\"Explain Significance\" is too Broad:** The prompt asks to \"Explain Significance\" but doesn't sufficiently break down *what kind* of significance is expected. The feedback highlights a lack of depth beyond simple antagonism and pursuit. The prompt needs to explicitly ask for *why* the subject matters, its *impact on characters/plot*, and its *thematic relevance*.\n\n2.  **\"Analyze Query and Context\" is Generic:** While essential, this instruction doesn't push for the *type* of analysis needed for \"significance.\" It needs to encourage interpretation and synthesis, not just identification of facts.\n\n3.  **\"Discuss Nuances\" is Vague:** The instruction \"discuss motivations, capabilities, and the scale of influence\" is present, but it wasn't effectively leveraged by the LLM in the example. The prompt needs to be more directive about *how* to use these elements to build the case for significance.\n\n4.  **Lack of Emphasis on Synthesis and Interpretation:** The prompt mentions \"Synthesize Information\" but doesn't stress the need to connect disparate pieces of context to form a coherent *argument for significance*. The feedback noted an over-reliance on direct phrases, suggesting a failure to synthesize.\n\n5.  **No Guidance on Handling Ambiguity or Complexity:** The feedback pointed out the need to clarify the impact of Sarna's revelation. The prompt could instruct the LLM to explore how complex relationships or dualities enhance the significance.\n\n6.  **Limited Direction on Thematic Connection:** The prompt asks to contextualize, but the feedback indicates the thematic connection was superficial. The prompt should explicitly ask for *how* the subject matter contributes to or exemplifies broader themes.\n\n**Suggested Prompt Modifications:**\n\nTo address these issues, the prompt should be more directive and specific, guiding the LLM towards deeper analysis and synthesis.\n\n**Revised Prompt Structure and Content:**\n\nYou are an AI assistant tasked with answering queries based on provided context derived from a knowledge graph. Your goal is to elucidate the *significance* of the subject matter in relation to the query. Focus on its *impact, implications, narrative function, and thematic relevance*, rather than merely summarizing retrieved facts.\n\n**Instructions:**\n\n1.  **Deconstruct Significance:** For the subject in the query, analyze its role by considering:\n    *   **Causal Impact:** How does the subject *cause* events or reactions within the narrative/domain?\n    *   **Character Impact:** How does the subject affect the motivations, development, or relationships of key characters?\n    *   **Narrative Function:** What is the subject's purpose in advancing the plot, creating conflict, or driving the story forward?\n    *   **Thematic Resonance:** How does the subject embody, challenge, or explore overarching themes of the narrative/domain?\n    *   **Unique Characteristics/Motivations:** What specific traits, abilities, or underlying reasons differentiate the subject and contribute to its importance?\n\n2.  **Synthesize and Interpret Context:** Integrate the provided context holistically. Connect related pieces of information to build a comprehensive argument for the subject's significance. Avoid simply listing facts or direct phrases; aim for cohesive prose that interprets the context.\n\n3.  **Address Nuances and Complexities:** If the context reveals complexities (e.g., dual roles, conflicting motivations, layered origins), explain how these nuances deepen or complicate the subject's significance.\n\n4.  **Contextualize Crucial Elements:** Briefly explain the role of any critical entities, locations, or past events mentioned in the context that are essential for understanding the subject's significance.\n\n5.  **Direct and Focused Explanation:** Provide a clear, concise, and explanatory answer. Directly address the query, focusing solely on the significance of the requested subject.\n\n**Query:**\n{}\n\n**Context:**\n{}\n\nYour response should be a thorough explanation of the significance, directly addressing the query using and interpreting the provided context.\n\n**Rationale for Changes:**\n\n*   **\"Deconstruct Significance\"**: Replaces the vague \"Explain Significance\" with explicit sub-points (Causal Impact, Character Impact, etc.) that directly map to the feedback's identified weaknesses. This guides the LLM to look for deeper meaning.\n*   **\"Synthesize and Interpret Context\"**: Strengthened to emphasize \"interpret\" and \"build a comprehensive argument,\" pushing for synthesis over listing.\n*   **\"Address Nuances and Complexities\"**: Directly targets the feedback regarding Sarna and how to handle complexity, making it a proactive instruction.\n*   **\"Thematic Resonance\"**: Added as a specific point under \"Deconstruct Significance\" to ensure thematic connections are not superficial.\n*   **\"Unique Characteristics/Motivations\"**: Reinforces the need for specific details beyond generic descriptions.\n\nThese changes aim to make the prompt more prescriptive, guiding the LLM towards the analytical depth required for high-quality \"significance\" explanations, thereby improving ROUGE scores by encouraging more relevant and well-structured output.",
  "graph_builder_prompt": "\nYou will be given a text. Your goal is to identify entities in the text and all the relationships among the identified entities.\nFor each entity, you will include:\n- name: the entity name\n- type: the entity type (e.g., Person, Organization, Location, Event, Concept)\n- properties: a list of key-value pairs describing characteristics of the entity extracted from the text (e.g., for a person: age, role, description; for a location: description, significance). Each property should have a \"key\" and \"value\" field.\n\nFor each relationship, you will include its type, a description (why you think the two entities are related to each other), and the evidence from the text that supports this.\nThe relationships must be among the extracted entities.\nProvide a list of triplets in your answer.\n\nReturn no more than 20 entities and 30 relationships. \n\nText:\n{TEXT_CHUNK}\n\nProvide the reasoning that led to your response.\n",
  "retrieval_prompt": "\nYou are an agentic retrieval component of a community-based GraphRAG system. Your goal is to select the most relevant communities from the knowledge graph to answer the following query: What is the significance of the Misty Ones in the story?.\nYou can select more than one community. \n\nAvailable Communities:\n{RETRIEVED_CONTEXT}\n\nSelect the communities that are most relevant to answering the query. Choose communities that together provide comprehensive coverage of the information needed.\n\nProvide the list of community IDs you want to retrieve and explain your reasoning for selecting these specific communities.\n"
}